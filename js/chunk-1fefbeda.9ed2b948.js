(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1fefbeda"],{"2edc":function(t,e,s){},4365:function(t,e,s){},8222:function(t,e,s){"use strict";s("8c77")},"84ac":function(t,e,s){"use strict";s.r(e);var o=s("ac7c"),i=(s("14d9"),s("2f62")),a=s("f3e4"),r=s("e71f"),c=s("e31c"),d=s("691b"),n=s("1f0b");s("b7ef");var l={data:()=>({nPay:{goods:"",price:""},qr:"",ti:"",res:{createdQrcode:!1,paid:!1},storeId:"n20fz-id19l-02n18-15o48-r59gl"}),methods:{_isIE(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")&&parseInt(t.split("msie")[1])},_open(t){this._isIE()&&this._isIE()<10?alert("internet explorer 10 이상 지원합니다."):void 0!==this.qr&&this.nPay.goods===t.productName&&this.nPay.price===t.productAmount||(this.nPay.goods=t.productName,this.nPay.price=t.productAmount,this._createQrcode())},_createQrcode(){var t="https://api.instapay.kr/s2/sell?"+("goods="+encodeURIComponent(btoa(unescape(encodeURIComponent(this.nPay.goods))))+"&price="+this.nPay.price+"&ldate=nil"),e=new XMLHttpRequest;const s=this;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&s._resultQrcode(this.responseText)},e.open("get",t,!0),e.setRequestHeader("authorization","Bearer "+this.storeId),e.send()},_resultQrcode(t){var e=JSON.parse(t);"ok"===e.result&&this._create(e.gid)},_create(t){var e="https://api.instapay.kr/s2/buy?i="+t,s=new XMLHttpRequest;const o=this;s.onreadystatechange=function(){4==this.readyState&&200==this.status&&o._result(this.responseText)},s.open("get",e,!0),s.setRequestHeader("authorization","Bearer "+this.storeId),s.send()},_result(t){var e=JSON.parse(t);"ok"===e.result&&(this.qr=e.qr,this.ti=e.ti,this.re=e.re,this.res.createdQrcode=!0)}}},u={name:"Order",components:{modalWrap:s("7402").a},mixins:[l],props:["book","price","ids"],mounted(){this._open({productName:this.book.join(","),productAmount:this.price})},methods:{close(){this.$emit("close")}}},h=(s("beb1"),s("2877")),_=Object(h.a)(u,(function(){var t=this,e=t._self._c;return e("modalWrap",{on:{close:t.close}},[e("template",{slot:"head"},[e("h2",[t._v("발주(결제)")])]),e("template",{slot:"body"},[e("section",{staticClass:"info"},[e("h3",[t._v("\n        "+t._s(t.book[0])+" "),t.book.length>1?e("span",[t._v("외 "+t._s(t.book.length-1)+"권")]):t._e()]),e("p",{staticClass:"price"},[t._v(t._s(t.price.toLocaleString())+"원")]),e("div",{staticClass:"qr-wrap"},[e("div",{staticClass:"center"},[e("img",{attrs:{src:t.qr,alt:""}})]),e("div",{staticClass:"pay"},[t._v("인스타페이 앱으로 결제해 주세요")])])])])],2)}),[],!1,null,"0ef9ae68",null).exports,p=s("68e0"),b={components:{BookListMobileSkeleton:n.a,BookListSkeleton:d.a},mixins:[l],props:["id","orderTimeId"],data:()=>({books:[],selected:[],checkCount:0,checkPrice:0,buyList:[],buyId:[]}),computed:{...Object(i.b)("common",["windowWidth","mobile","skeletonLoading"]),bookCount(){if(0===this.books[0].data.shop_order_status){let t=0;return this.books.forEach(e=>t+=Number(e.data.count)),t}return 0},totalPrice(){let t=0;return this.books.forEach(e=>{t+=e.data.price*e.data.supply_rate*e.data.reply_count/100}),t}},watch:{selected(){1===this.books[0].data.shop_order_status&&(this.checkCount=0,this.checkPrice=0,this.books.forEach(t=>{this.selected.includes(t.id)&&(this.checkCount+=t.data.count,this.checkPrice+=t.data.price*t.data.supply_rate*t.data.count/100)}))}},async created(){try{this.$store.commit("common/setSkeleton",!0);const{uid:t}=Object(a.b)("userInfo"),e=Object(r.h)(Object(r.b)(c.b,"orderRequest"),Object(r.l)("uid","==",t),Object(r.l)("sid","==",Number(this.id)),Object(r.l)("order_time_id","==",this.orderTimeId));(await Object(r.e)(e)).forEach(t=>{this.books.push({id:t.id,data:t.data()})})}catch(t){console.log(t)}this.$store.commit("common/setSkeleton",!1)},methods:{async order(){if(0===this.checkCount)return void alert("책을 선택해 주세요");this.buyList=[],this.buyId=[],this.books.forEach(t=>{this.selected.includes(t.id)&&(this.buyList.push(t.data.subject),this.buyId.push(t.id))}),this._open({productName:this.buyList.join(","),productAmount:this.checkPrice}),this.mobile?this.$modal.show(_,{book:this.buyList,price:this.checkPrice},Object(p.a)("ModalOrder","95%","auto",!1)):this.$modal.show(_,{qr:this.qr,book:this.buyList,price:this.checkPrice,ids:this.selected},Object(p.a)("ModalOrder","500px","auto",!1));const t=Object(r.m)(c.b);try{await this.books.forEach(e=>{const s=Object(r.d)(c.b,"orderRequest",e.id);t.update(s,{shop_order_status:3})}),await this.buyId.forEach(e=>{const s=Object(r.d)(c.b,"orderRequest",e);t.update(s,{order_check:!0})}),await t.commit()}catch(t){console.log(t)}}}},v=(s("8222"),{name:"OrderResult",components:{OrderResultList:Object(h.a)(b,(function(){var t,e,s,i=this,a=i._self._c;return a("section",[!i.mobile&&i.skeletonLoading?a("BookListSkeleton"):i._e(),i.mobile&&i.skeletonLoading?a("BookListMobileSkeleton"):i._e(),i.mobile||i.skeletonLoading?i._e():a("section",{staticClass:"header d-flex"},[i._m(0),a("div",[i._v("ISBN")]),i._m(1),a("div",[i._v("공급가")]),a("div",[i._v("주문")]),a("div",[i._v("공급")])]),a("ul",{staticClass:"body"},i._l(i.books,(function(t,e){var s,r;return a("li",{key:e,staticClass:"d-flex align-center"},[a("div",{staticClass:"d-flex align-center info-wrap"},[a("div",{staticClass:"ck-box"},[a(o.a,{attrs:{value:t.id,disabled:1!==(null===(s=i.books[0])||void 0===s?void 0:s.data.shop_order_status)||0===t.data.reply_count},model:{value:i.selected,callback:function(t){i.selected=t},expression:"selected"}})],1),a("div",{staticClass:"book-info"},[a("h3",[i._v(i._s(t.data.subject))]),a("div",{staticClass:"author"},[i._v(i._s(t.data.author))])])]),a("div",{staticClass:"isbn"},[i._v(i._s(t.data.isbn))]),a("div",{staticClass:"d-flex price-info"},[a("div",{staticClass:"normal-price"},[i.mobile?a("span",[i._v("정가")]):i._e(),i._v(" "+i._s(null===(r=t.data.price)||void 0===r?void 0:r.toLocaleString()))]),a("div",[i.mobile?a("span",[i._v("공급률")]):i._e(),i._v(" "+i._s(t.data.supply_rate)+"%")])]),a("div",{staticClass:"final-price"},[i.mobile?a("span",[i._v("공급가")]):i._e(),i._v(" "+i._s((t.data.price*t.data.supply_rate/100).toLocaleString())+" 원")]),a("div",{staticClass:"count"},[i.mobile?a("span",[i._v("주문")]):i._e(),i._v(" "+i._s(t.data.count))]),a("div",{staticClass:"count"},[i.mobile?a("span",[i._v("공급")]):i._e(),i._v(" "+i._s(null===t.data.reply_count?"-":t.data.reply_count))])])})),0),(null===(t=i.books[0])||void 0===t?void 0:t.data.memo.length)>1&&0!==i.books.length?a("section",{staticClass:"memo"},[a("h4",[i._v("메모")]),a("div",[i._v(i._s(null===(e=i.books[0])||void 0===e?void 0:e.data.memo))])]):i._e(),i.skeletonLoading?i._e():a("section",{staticClass:"total-wrap mt24"},[a("div",[a("span",{staticClass:"total-prod"},[i._v("총 "),0===this.books[0].data.shop_order_status?a("span",[i._v(i._s(i.bookCount))]):i._e(),1===this.books[0].data.shop_order_status?a("span",[i._v(i._s(i.checkCount))]):i._e(),i._v(" 권")]),a("span",{staticClass:"total"},[i._v("합계 "),0===this.books[0].data.shop_order_status?a("span",[i._v(i._s(i.totalPrice.toLocaleString()))]):i._e(),1===this.books[0].data.shop_order_status?a("span",[i._v(i._s(i.checkPrice.toLocaleString()))]):i._e(),i._v("원")])]),a("button",{staticClass:"primary",attrs:{disabled:1!==(null===(s=i.books[0])||void 0===s?void 0:s.data.shop_order_status)},on:{click:i.order}},[i._v("발주")])])],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"d-flex dual"},[t("div",[this._v("발주")]),t("div",[this._v("품목정보")])])},function(){var t=this._self._c;return t("div",{staticClass:"d-flex"},[t("div",[this._v("정가")]),t("div",[this._v("공급률")])])}],!1,null,"683d237e",null).exports},data(){return{id:this.$route.params.id,date:this.$route.params.date,publisher:this.$route.params.publisher,orderTimeId:this.$route.params.orderTimeId}}}),m=(s("aefe"),Object(h.a)(v,(function(){var t=this,e=t._self._c;return e("section",[e("h2",{staticClass:"sub-title"},[t._v("내역서 확인")]),e("section",{staticClass:"sub-container"},[e("article",{staticClass:"order-info d-flex justify-space-between"},[e("div",[t._v("\n        출판사명: "),e("strong",[t._v(t._s(t.publisher))])]),e("div",[t._v("주문일자 : "+t._s(t.date))])]),e("OrderResultList",{attrs:{id:t.id,orderTimeId:t.orderTimeId}})],1)])}),[],!1,null,"57a95d22",null));e.default=m.exports},"8c77":function(t,e,s){},aefe:function(t,e,s){"use strict";s("2edc")},beb1:function(t,e,s){"use strict";s("4365")}}]);